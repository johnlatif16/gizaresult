<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>الصفحة الرئيسية</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
  th { background-color: #3b82f6; color: white; }
  .disclaimer { text-align: center; font-size: 14px; color: #dc3545; background: #fff0f0; padding: 10px; border: 1px solid #f5c2c7; border-radius: 8px; margin-bottom: 20px; }
</style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-start min-h-screen p-6">

<div class="disclaimer">
  النتيجة مظهرتش
  <br>
  <div class="disclaimer" style="background: #01f7ff00; border-color: #c3e6cb;">
    <span style="color: green;">"إِلهُ السَّلاَمِ مَعَكُمْ أَجْمَعِينَ. آمِينَ." (رو 15: 33).</span>
  </div>
</div>

<div class="disclaimer" style="color: #00008B; background: #01f7ff00; border-color: #c3e6cb;">
  ممنوع منعاً باتاً تفتح اي حاجة او تحاول تجيب النتيجة من مكان تاني علشان هيحصل مشكلة وانا مش مسؤول
</div>
<div class="disclaimer">
  هذا الموقع غير تابع لأي جهة حكومية أو وزارة، وإنما هو مبادرة شخصية للمساعدة في الحصول على النتائج فقط.
  البيانات سرية تامة ثم تتحذف بعد الاستطلاع على النتيجة
</div>
<p style="color: #6f42c1; font-weight: bold;">
"ستظهر النتيجة على الصفحة الإلكترونية وسيتم أيضًا إرسالها إلى البريد الإلكتروني خلال دقيقتين تقريبًا."
</p>

<h1 class="text-4xl font-bold mb-10 text-gray-800">مرحبا بك في موقع الاستعلام عن النتائج</h1>

<div class="space-y-5 mb-6">
  <button onclick="showPayment()" class="px-8 py-3 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">إتمام الدفع للاستعلام عن النتيجة</button>
  <button onclick="showCheck()" class="px-8 py-3 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition">استعلام عن النتيجة بعد الدفع</button>
</div>

<!-- الدفع -->
<div class="mt-6 p-6 bg-white rounded-lg shadow max-w-md w-full hidden" id="payment">
  <h2 class="text-2xl font-semibold mb-4">الدفع عن طريق تحويل محفظة</h2>
  <p class="mb-4">رقم التحويل: <strong>01274445091</strong></p>
  <form action="/pay" method="post" enctype="multipart/form-data" class="space-y-4">
    
    <select name="gradeLevel" id="gradeLevel" required class="w-full p-2 border rounded">
      <option value="">اختر الصف</option>
      <option value="الصف الاول الابتدائي">الصف الاول الابتدائي</option>
      <option value="الصف الثاني الابتدائي">الصف الثاني الابتدائي</option>
      <option value="الصف الثالث الابتدائي">الصف الثالث الابتدائي</option>
      <option value="الصف الرابع الابتدائي">الصف الرابع الابتدائي</option>
      <option value="الصف الخامس الابتدائي">الصف الخامس الابتدائي</option>
      <option value="الصف السادس الابتدائي">الصف السادس الابتدائي</option>
      <option value="الصف الاول الاعدادي">الصف الاول الاعدادي</option>
      <option value="الصف الثاني الاعدادي">الصف الثاني الاعدادي</option>
      <option value="الصف الثالث الاعدادي">الصف الثالث الاعدادي</option>
      <option value="الصف الاول الثانوي">الصف الاول الثانوي</option>
      <option value="الصف الثاني الثانوي">الصف الثاني الثانوي</option>
    </select>

    <input type="text" name="studentNumber" id="studentNumber" placeholder="" class="w-full p-2 border rounded hidden" required>

    <input name="phone" placeholder="رقم الهاتف" required class="w-full p-2 border rounded">
    <input type="file" name="screenshot" required class="w-full">
    <input name="email" placeholder="البريد الإلكتروني" required class="w-full p-2 border rounded">
    <button type="submit" class="w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">تأكيد الدفع</button>
  </form>
</div>

<!-- استعلام النتيجة -->
<div class="mt-6 p-6 bg-white rounded-lg shadow max-w-3xl w-full hidden" id="check">
  <h2 class="text-2xl font-semibold mb-4">استعلام عن النتيجة</h2>
  <form id="checkForm" class="space-y-4">
    <input name="phone" id="phoneInput" placeholder="رقم الهاتف" required class="w-full p-2 border rounded">
    <button type="submit" class="w-full py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">استعلام</button>
  </form>

  <div id="resultContainer" class="mt-6 hidden">
    <h3 class="text-xl font-semibold mb-2">بيانات الطالب</h3>
    <p id="studentInfo"></p>

    <h3 class="text-lg font-semibold mt-4">المواد الأساسية</h3>
    <table id="mainSubjectsTable">
      <thead><tr><th>المادة</th><th>الدرجة</th><th>من</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3 class="text-lg font-semibold mt-4">المواد الإضافية</h3>
    <table id="additionalSubjectsTable">
      <thead><tr><th>المادة</th><th>الدرجة</th><th>من</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3 class="text-lg font-semibold mt-4">الإجمالي والنسبة</h3>
    <table>
      <tr><th>المجموع الكلي</th><td id="totalScore"></td></tr>
      <tr><th>المجموع الكلي الممكن</th><td id="totalOutOf"></td></tr>
      <tr><th>النسبة المئوية</th><td id="percentage"></td></tr>
    </table>
  </div>
</div>

<p>هذا الموقع غير تابع لأي جهة حكومية</p>

<script>
function showPayment() {
  document.getElementById('payment').classList.remove('hidden');
  document.getElementById('check').classList.add('hidden');
}
function showCheck() {
  document.getElementById('check').classList.remove('hidden');
  document.getElementById('payment').classList.add('hidden');
}

// تغيير ظهور حقل الرقم حسب الصف
const gradeSelect = document.getElementById('gradeLevel');
const studentNumber = document.getElementById('studentNumber');

gradeSelect.addEventListener('change', () => {
  const grade = gradeSelect.value;
  if(!grade) {
    studentNumber.classList.add('hidden');
    studentNumber.value = '';
    return;
  }
  studentNumber.classList.remove('hidden');
  if(grade.includes('الصف الاول الابتدائي') || grade.includes('الصف الثاني الابتدائي') || grade.includes('الصف الثالث الابتدائي') ||grade.includes('الصف الرابع الابتدائي') ||grade.includes('الصف الخامس الابتدائي') ||grade.includes('الصف السادس الابتدائي') ||
     grade.includes('الصف الاول الاعدادي') || grade.includes('الصف الثاني الاعدادي') ||
     grade.includes('الصف الاول الثانوي') || grade.includes('الصف الثاني الثانوي')) {
    studentNumber.placeholder = "الرقم القومي";
  } else if(grade.includes('الصف الثالث الاعدادي')) {
    studentNumber.placeholder = "رقم الجلوس";
  } else {
    studentNumber.placeholder = "";
  }
});

// استعلام النتيجة
document.getElementById('checkForm').addEventListener('submit', async e => {
  e.preventDefault();
  const phone = document.getElementById('phoneInput').value;
  const res = await fetch('/check-result', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({phone})
  });
  const resultText = await res.text();
  try {
    const result = JSON.parse(resultText);
    const infoDiv = document.getElementById('studentInfo');
infoDiv.innerHTML = `
  <p><strong>اسم الطالب:</strong> ${result.name}</p>
  ${result.seatNumber ? `<p><strong>رقم الجلوس:</strong> ${result.seatNumber}</p>` : ''}
  ${result.nationalID ? `<p><strong>الرقم القومي:</strong> ${result.nationalID}</p>` : ''}
  <p><strong>المرحلة:</strong> ${result.stage}</p>
  <p><strong>الصف:</strong> ${result.gradeLevel}</p>
  <p><strong>المدرسة:</strong> ${result.schoolName}</p>
  <p><strong>ملاحظات:</strong> ${result.notes}</p>
`;

    const mainTbody = document.querySelector('#mainSubjectsTable tbody');
    mainTbody.innerHTML = '';
    result.mainSubjects.forEach(sub => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${sub.name}</td><td>${sub.score}</td><td>${sub.outOf}</td>`;
      mainTbody.appendChild(tr);
    });
    const addTbody = document.querySelector('#additionalSubjectsTable tbody');
    addTbody.innerHTML = '';
    result.additionalSubjects.forEach(sub => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${sub.name}</td><td>${sub.score}</td><td>${sub.outOf}</td>`;
      addTbody.appendChild(tr);
    });
    document.getElementById('totalScore').textContent = result.totalScore;
    document.getElementById('totalOutOf').textContent = result.totalOutOf;
    document.getElementById('percentage').textContent = result.percentage + '%';
    document.getElementById('resultContainer').classList.remove('hidden');
  } catch(err) {
    alert(resultText);
  }
});
</script>

</body>
</html>
